<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    
    <!-- Hidden input element for file selection -->
    <div class="load-file-div">        
        <button id="loadFileToggle" class="collapsed">+</button>
        <div class="content">                
            <!-- Button to trigger the file dialog -->
            <button class="file-button" onclick="myFileDialog.open()"><i class="fa fa-file"></i></button>

            <!-- Text area to display file contents -->
            <textarea id="fileContents" rows="10" cols="50"></textarea><input type="file" id="fileDialog" style="display: none">
        </div> 
    </div>

    <!-- Container for displaying div panels -->
    <div id="outputContainer"></div>
    
    <script>
        
        const myFileDialog =  new FileDialog('fileDialog');
        const FileToggle = CreateToggleButton('loadFileToggle');
                
        const isValidUrl = urlString=> {
            try { 
                return new URL(urlString); 
            }
            catch(e){ 
                return null; 
            }
        }

        function FileDialog(id) {            
            this.element = document.getElementById(id);
            this.element.addEventListener('change', 
                (event) => {                     
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) { 
                            var contents = e.target.result;
                            // Display file contents in the text area
                            document.getElementById('fileContents').value = contents;
                            myFileDialog.readFile(contents);                                      
                        };
                        reader.readAsText(file); 
                    }                    
                });

            this.open = function() {
                this.element.click();
            }

            this.readFile = function(fileContents) {                
                // Process each line and create div panels
                const lines = fileContents.split('\n');
                    
                const outputContainer = document.getElementById('outputContainer');
                outputContainer.innerHTML = ''; // Clear existing content
    
                let lastLevel = 0;  
                let stack = [];
                stack[stack.length] = outputContainer;
                stack[stack.length] = outputContainer;
                lines.forEach((line, index) => {
                    var trimmedLine = line.trimLeft(); // Remove leading spaces
                    const indentationLevel = (line.length - trimmedLine.length) / 2;
                    trimmedLine = trimmedLine.replace("- [ ] ", "");
    
                    var doUpALevel = function() {
                        if (lastLevel < indentationLevel) {
                            stack[stack.length] = null;
                        }
                    }

                    var doDownALevel = function() {
                        if (lastLevel > indentationLevel) {
                            stack.pop();                            
                        }
                    }

                    if (indentationLevel > 0) { 
                        var div = document.createElement('div');              
                        div.textContent = trimmedLine;                        
                        div.classList.add('floating-sub-div');                                                              
                        doUpALevel();
                        doDownALevel();
                        stack[stack.length - 1] = div;                                                
                        lastLevel = indentationLevel;
                    } else {               
                        doDownALevel();
                        stack[stack.length - 1] = CreateFloatingBox(trimmedLine); 
                        lastLevel = 0;                       
                    }
                    stack[stack.length - 2].appendChild(stack[stack.length - 1]);
                });                                 
            }
        }

        function CreateFloatingBox(text){            
            var div = document.createElement('div');
            div.classList.add('floating-div'); 
            
            div.appendChild(CreateToggleButton());                                     
            div.appendChild(document.createTextNode(text)); 

            const divSubPanel = document.createElement('div');
            divSubPanel.classList.add('content');
            divSubPanel.classList.add('collapsed');
            div.appendChild(divSubPanel); 
            return div;
        }
        
        function CreateToggleButton(id) {            
            var element = null;
            if (id){
                element = document.getElementById(id);
            }            
            else {                
                element = document.createElement('button'); 
                element.textContent = '+'; 
            }                       

            element.addEventListener('click', () => {                 
                const allContentBlocks = document.querySelectorAll(".content");  
                allContentBlocks.forEach((block) => {
                    if (!block.classList.contains('collapsed')){
                        block.previousElementSibling.classList.remove('collapsed'); //show button
                        block.classList.add('collapsed'); // hide content
                    }                    
                })
                element.nextElementSibling.classList.remove('collapsed');
                element.classList.add('collapsed');

                if (element.parentElement.classList.contains('floating-div')){
                    element.parentElement.classList.add('zoomed');                
                    document.querySelector('content').classList.remove('zoomed');  
                }                                
            });
            return element;
        }

    </script>
    <style>
        .file-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            vertical-align: top;
        }

        /* Add an icon to the button */
        .file-button i {
            margin-right: 5px;
        }

        .load-file-div{                                    
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 10px;
            margin: 5px 0; 
            display: inline-block;           
        }
                
        .floating-div {
            position: relative;
            border: 1px solid #ccc;
            padding: 10px;
            margin: 5px 0;
            background-color: #f9f9f9;
            transition: transform 0.3s ease; 
        } 

        #outputContainer {
            position: relative;
        }
        .zoomed {
            transform: scale(1.5);
        }

        .floating-sub-div {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 5px 0;
            background-color: aqua;
        } 
        
        /* Style the collapsible content (hidden by default) */
        .content {                        
            padding: 0 18px;
            overflow: hidden;
            background-color: #f1f1f1;
        }

        .collapsed {
            display: none;
        }
    </style>
</body>
</html>
